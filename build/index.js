(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var i in t)e.o(t,i)&&!e.o(a,i)&&Object.defineProperty(a,i,{enumerable:!0,get:t[i]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,t=window.wp.i18n,i=window.wp.element,n=window.wp.components,r=window.wp.editor,o=window.wp.plugins,l=window.wp.data,s=window.wp.apiFetch;var d=e.n(s);const g=window.wp.compose,c=window.wp.hooks,w=e=>{const a=(0,l.select)("core/editor").getEditedPostPreviewLink();if(a){const t=new URL(a,window.location.origin);t.searchParams.set("grid_intensity",e),window.open(t.toString(),"_blank")}},p=(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20","aria-hidden":"true",focusable:"false",style:{marginLeft:"0.5em",verticalAlign:"middle"}},(0,a.createElement)("path",{d:"M19.5 4.5h-7V6h4.44l-5.97 5.97 1.06 1.06L18 7.06v4.44h1.5v-7Zm-13 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3H17v3a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h3V5.5h-3Z"})),m=()=>{const[e,r]=(0,i.useState)({images:"1",videos:"1",typography:"1",api_key:""}),[o,l]=(0,i.useState)(!1),[s,g]=(0,i.useState)(!1),[c,w]=(0,i.useState)(null),[p,m]=(0,i.useState)(!0);(0,i.useEffect)((()=>{(async()=>{try{const e=await d()({path:"/grid-aware-wp/v1/settings"});e&&r(e)}catch(e){w({type:"error",message:(0,t.__)("Error loading settings.","grid-aware-wp")})}finally{m(!1)}})()}),[]);const y=async(a,t)=>{const i="api_key"===a?t:t?"1":"0",n={...e,[a]:i};r(n)};return p?(0,a.createElement)("div",{className:"grid-aware-wp-loading"},(0,a.createElement)(n.Spinner,null)):(0,a.createElement)("div",{className:"grid-aware-wp-settings"},c&&(0,a.createElement)(n.Notice,{status:c.type,onRemove:()=>w(null)},c.message),(0,a.createElement)("h2",null,(0,t.__)("Electricity Maps API Key","grid-aware-wp")),(0,a.createElement)("p",null,(0,t.__)("An API key is required to fetch real-time grid intensity data from Electricity Maps. This allows the plugin to optimize your site based on current energy conditions. You can get your API key from the ","grid-aware-wp"),(0,a.createElement)("a",{href:"https://portal.electricitymaps.com/dashboard",target:"_blank",rel:"noopener noreferrer"},(0,t.__)("Electricity Maps dashboard","grid-aware-wp")),"."),(0,a.createElement)("div",{style:{display:"flex",gap:"1em",marginBottom:"1.5em"}},(0,a.createElement)(n.TextControl,{value:e.api_key,onChange:e=>y("api_key",e),style:{flex:1,height:"36px"},label:null,placeholder:(0,t.__)("Enter your API key","grid-aware-wp"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,a.createElement)(n.Button,{variant:"secondary",onClick:async()=>{if(e.api_key){g(!0),w(null);try{const a=await d()({path:"/grid-aware-wp/v1/test-api",method:"POST",data:{api_key:e.api_key,zone:"ES"}});a&&a.success?w({type:"success",message:(0,t.__)("API connection successful! Carbon intensity data is available.","grid-aware-wp")}):w({type:"error",message:(0,t.__)("API connection failed. Please check your API key.","grid-aware-wp")})}catch(e){w({type:"error",message:(0,t.__)("API connection failed: "+(e.message||"Unknown error"),"grid-aware-wp")})}finally{g(!1)}}else w({type:"error",message:(0,t.__)("Please enter an API key first.","grid-aware-wp")})},isBusy:s,disabled:s||!e.api_key},s?(0,t.__)("Testing...","grid-aware-wp"):(0,t.__)("Test API Connection","grid-aware-wp"))),(0,a.createElement)("h2",null,(0,t.__)("Grid Aware WP Settings","grid-aware-wp")),(0,a.createElement)("fieldset",null,(0,a.createElement)(n.PanelRow,null,(0,a.createElement)(n.CheckboxControl,{label:(0,t.__)("Enable grid-aware image handling","grid-aware-wp"),help:(0,t.__)("Optimizes images based on grid intensity, adjusting quality and loading strategies to reduce energy consumption.","grid-aware-wp"),checked:"1"===e.images,onChange:e=>y("images",e),__nextHasNoMarginBottom:!0})),(0,a.createElement)(n.PanelRow,null,(0,a.createElement)(n.CheckboxControl,{label:(0,t.__)("Enable grid-aware video handling","grid-aware-wp"),help:(0,t.__)("Manages video playback and quality based on grid conditions, potentially reducing resolution or deferring autoplay during high-intensity periods.","grid-aware-wp"),checked:"1"===e.videos,onChange:e=>y("videos",e),__nextHasNoMarginBottom:!0})),(0,a.createElement)(n.PanelRow,null,(0,a.createElement)(n.CheckboxControl,{label:(0,t.__)("Enable grid-aware typography handling","grid-aware-wp"),help:(0,t.__)("Adjusts font loading and rendering based on grid intensity, optimizing for energy efficiency while maintaining readability.","grid-aware-wp"),checked:"1"===e.typography,onChange:e=>y("typography",e),__nextHasNoMarginBottom:!0}))),(0,a.createElement)(n.Button,{variant:"primary",onClick:async()=>{l(!0),w(null);try{await d()({path:"/grid-aware-wp/v1/settings",method:"POST",data:{options:e}})&&w({type:"success",message:(0,t.__)("Settings saved successfully.","grid-aware-wp")})}catch(e){w({type:"error",message:(0,t.__)("Error saving settings.","grid-aware-wp")})}finally{l(!1)}},isBusy:o,disabled:o,style:{marginTop:"1em"}},o?(0,t.__)("Saving...","grid-aware-wp"):(0,t.__)("Save Settings","grid-aware-wp")))};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("grid-aware-wp-settings");e&&(0,i.createRoot)(e).render((0,a.createElement)(m,null))})),window.wp?.plugins&&((0,o.registerPlugin)("grid-aware-wp",{render:()=>{const[e,o]=(0,i.useState)({images:"1",videos:"1",typography:"1",api_key:""}),[s,g]=(0,i.useState)(!1);(0,i.useEffect)((()=>{const e=(0,l.select)("core/editor").getCurrentPostId();(async()=>{try{const a=await d()({path:"/grid-aware-wp/v1/settings"+(e?`?post_id=${e}`:"")});a&&(o(a),g(!!e))}catch(e){const a=window.gridAwareWPOptions||{};o({images:void 0!==a.images?a.images:"1",videos:void 0!==a.videos?a.videos:"1",typography:void 0!==a.typography?a.typography:"1",api_key:void 0!==a.api_key?a.api_key:""})}})()}),[]);const c=async(a,t)=>{const i="api_key"===a?t:t?"1":"0",n={...e,[a]:i};try{const e=(0,l.select)("core/editor").getCurrentPostId(),a=await d()({path:"/grid-aware-wp/v1/settings"+(e?`?post_id=${e}`:""),method:"POST",data:{options:n}});a&&o(a)}catch(a){o(e)}};return(0,a.createElement)(r.PluginDocumentSettingPanel,{name:"grid-aware-wp-panel",title:(0,t.__)("Grid Aware WP","grid-aware-wp"),className:"grid-aware-wp-panel"},(0,a.createElement)("p",null,s?(0,t.__)("These settings will override the global settings for this page only.","grid-aware-wp"):(0,t.__)("These are the global settings that will be used by default.","grid-aware-wp")),(0,a.createElement)(n.PanelRow,null,(0,a.createElement)(n.CheckboxControl,{label:(0,t.__)("Enable grid-aware image handling","grid-aware-wp"),checked:"1"===e.images,onChange:e=>c("images",e),__nextHasNoMarginBottom:!0})),(0,a.createElement)("p",{className:"description"},(0,t.__)("Optimizes images based on grid intensity, adjusting quality and loading strategies to reduce energy consumption.","grid-aware-wp")),(0,a.createElement)(n.PanelRow,null,(0,a.createElement)(n.CheckboxControl,{label:(0,t.__)("Enable grid-aware video handling","grid-aware-wp"),checked:"1"===e.videos,onChange:e=>c("videos",e),__nextHasNoMarginBottom:!0})),(0,a.createElement)("p",{className:"description"},(0,t.__)("Manages video playback and quality based on grid conditions, potentially reducing resolution or deferring autoplay during high-intensity periods.","grid-aware-wp")),(0,a.createElement)(n.PanelRow,null,(0,a.createElement)(n.CheckboxControl,{label:(0,t.__)("Enable grid-aware typography handling","grid-aware-wp"),checked:"1"===e.typography,onChange:e=>c("typography",e),__nextHasNoMarginBottom:!0})),(0,a.createElement)("p",{className:"description"},(0,t.__)("Adjusts font loading and rendering based on grid intensity, optimizing for energy efficiency while maintaining readability.","grid-aware-wp")),(0,a.createElement)(n.PanelRow,null,(0,a.createElement)(n.TextControl,{label:(0,t.__)("Electricity Maps API Key","grid-aware-wp"),value:e.api_key,onChange:e=>c("api_key",e)})),(0,a.createElement)("p",{className:"description"},(0,t.__)("Enter your Electricity Maps API key. This will override the global setting.","grid-aware-wp")),(0,a.createElement)("div",{style:{marginTop:"1.5em"}},(0,a.createElement)("strong",null,(0,t.__)("Preview with grid intensity:","grid-aware-wp")),(0,a.createElement)("div",{style:{display:"flex",gap:"0.5em",marginTop:"0.5em"}},(0,a.createElement)(n.Button,{isSecondary:!0,onClick:()=>w("low")},(0,t.__)("Low","grid-aware-wp")),(0,a.createElement)(n.Button,{isSecondary:!0,onClick:()=>w("medium")},(0,t.__)("Medium","grid-aware-wp")),(0,a.createElement)(n.Button,{isSecondary:!0,onClick:()=>w("high")},(0,t.__)("High","grid-aware-wp")))))}}),(0,o.registerPlugin)("grid-aware-wp-preview",{render:()=>(0,a.createElement)(i.Fragment,null,(0,a.createElement)(r.PluginPreviewMenuItem,{onClick:()=>w("low")},"Low Grid Intensity"),(0,a.createElement)(r.PluginPreviewMenuItem,{onClick:()=>w("medium")},"Medium Grid Intensity"),(0,a.createElement)(r.PluginPreviewMenuItem,{onClick:()=>w("high")},"High Grid Intensity")),icon:p}));const y=(0,g.createHigherOrderComponent)((e=>r=>{const o="core/image"===r.name,l="core/embed"===r.name&&r.attributes&&"string"==typeof r.attributes.url&&/^(https?:)?\/\/(www\.)?(youtube\.com|youtu\.be)\//.test(r.attributes.url);return o||l?(0,a.createElement)(i.Fragment,null,(0,a.createElement)(e,{...r}),(0,a.createElement)(n.Notice,{status:"warning",isDismissible:!1},o&&(0,t.__)("Images may display differently depending on the current grid intensity (Grid Aware WP).","grid-aware-wp"),l&&(0,t.__)("YouTube videos may display or behave differently depending on the current grid intensity (Grid Aware WP).","grid-aware-wp"),(0,a.createElement)("br",null),(0,t.__)("If you do not want this behavior, you can disable it in the ","grid-aware-wp"),(0,a.createElement)("a",{href:window.location.origin+"/wp-admin/admin.php?page=grid-aware-wp",onClick:e=>{e.preventDefault(),window.open(window.location.origin+"/wp-admin/admin.php?page=grid-aware-wp","_blank","noopener,noreferrer")},rel:"noopener noreferrer"},(0,t.__)("Grid Aware WP plugin general settings","grid-aware-wp")),(0,t.__)(" or in the sidebar settings for this page.","grid-aware-wp"))):(0,a.createElement)(e,{...r})}),"withGridAwareImageNotice");(0,c.addFilter)("editor.BlockEdit","grid-aware-wp/with-grid-aware-image-notice",y)})();